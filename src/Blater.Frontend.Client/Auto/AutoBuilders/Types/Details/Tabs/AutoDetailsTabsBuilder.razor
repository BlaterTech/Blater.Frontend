@inherits AutoDetailsBuilder<T>
@typeparam T where T : BaseDataModel


<BlaterCascadingValue
    T="T"
    Id="@CascadingValue">
    @if (Loading)
    {
        <MudProgressCircular
            Color="Color.Primary"
            Indeterminate="true"/>
    }
    else
    {
        if (Id == Guid.Empty)
        {
            <MudCard>
                <MudGrid>
                    <MudItem
                        xs="12">
                        <MudText
                            Typo="Typo.h4">
                            @ComponentLocalizationService.GetTitleValue(DetailsTabsConfiguration.Title)
                        </MudText>
                    </MudItem>
                    <MudItem
                        xs="12">
                        <MudText
                            Typo="Typo.h5">
                            @LocalizationService.GetValue("ItemNotFound")
                        </MudText>
                    </MudItem>
                </MudGrid>
            </MudCard>
        }
        else
        {
            <MudTabs
                Elevation="2"
                Rounded="true"
                ApplyEffectsToContainer="true"
                AlwaysShowScrollButtons="true"
                PanelClass="pa-6">
                @foreach (var tab in DetailsTabsConfiguration.PanelConfigurations)
                {
                    <MudTabPanel Text="@ComponentLocalizationService.GetTitleValue(tab.Title)">
                        @foreach (var group in tab.GroupConfigurations)
                        {
                            <MudGrid>
                                <MudItem
                                    xs="12"
                                    Class="d-flex">
                                    <MudText
                                        Typo="Typo.h6">
                                        @ComponentLocalizationService.GetGroupNameValue(group.Title)
                                    </MudText>
                                    @if (group.EnableEditButton)
                                    {
                                        <MudSpacer/>
                                        <MudIconButton
                                            Variant="Variant.Filled"
                                            Color="Color.Primary"
                                            Icon="@Material.Outlined.Edit"
                                            OnClick="@(async () => await EditCallback.InvokeAsync(Model))"/>
                                    }
                                </MudItem>
                                <MudItem
                                    xs="12">
                                    <MudSimpleTable
                                        Style="overflow-x: auto;"
                                        Elevation="0"
                                        Striped="true">
                                        <thead>
                                        @{
                                            var heads = group.Components
                                                             .Where(x => !string.IsNullOrWhiteSpace(x.HeadTitle))
                                                             .ToList();

                                            if (heads.Count > 0)
                                            {
                                                <tr>
                                                    @foreach (var head in heads)
                                                    {
                                                        <th>@head.HeadTitle</th>
                                                    }
                                                </tr>
                                            }
                                        }
                                        </thead>
                                        <tbody>
                                        @{
                                            foreach (var component in group.Components)
                                            {
                                                @RenderComponents(component)
                                            }
                                        }
                                        </tbody>
                                    </MudSimpleTable>
                                </MudItem>
                            </MudGrid>
                        }
                    </MudTabPanel>
                }
            </MudTabs>
        }
    }
</BlaterCascadingValue>